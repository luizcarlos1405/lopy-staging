import{d as e,S as t,I as r,a as s,s as n,m as o,b as a,i,c as d,e as l,p as c,f as u,T as g,g as p,h as m,j as f,k as v,l as E,n as h,o as D,q as w,D as y,r as T,t as $,u as O,v as x,w as L,x as b,y as R,z as S,A as P,B as A,C as _,E as I,F as N,G as F,H as C,J as M,K as G,L as k,M as V,N as j,O as Y,P as z,Q as X,R as H,U as q,V as B,W as U,X as Z,Y as W,Z as J,_ as K,$ as Q,a0 as ee,a1 as te,a2 as re,a3 as se,a4 as ne,a5 as oe,a6 as ae,a7 as ie,a8 as de,a9 as le,aa as ce,ab as ue,ac as ge}from"./client.6ed70bee.js";import{f as pe,P as me,T as fe,R as ve,e as Ee,a as he}from"./constants.dcda827f.js";import{l as De,P as we}from"./longpress.e20a0e3f.js";const ye={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let Te,$e,Oe,xe,Le,be,Re,Se,Pe,Ae,_e,Ie=!1,Ne=!1,Fe=!1;const Ce=new Map,Me=new Map,Ge=new WeakMap;function ke(t,r){Ce.get(r).delete(t),e(),0===Ce.get(r).size&&Ce.delete(r)}function Ve(e){return e.findIndex((e=>!!e[t]&&e[r]!==s))}function je(e){let{items:n,dropFromOthersDisabled:o}=Me.get(e.currentTarget);if(o&&e.currentTarget!==Le)return;if(Fe=!1,n=n.filter((e=>e[r]!==Re[r])),Le!==e.currentTarget){const e=Me.get(Le).items.filter((e=>!e[t]));u(Le,e,{trigger:g.DRAGGED_ENTERED_ANOTHER,id:Oe[r],source:p.POINTER})}else{const e=function(e){return e.findIndex((e=>e[r]===s))}(n);-1!==e&&n.splice(e,1)}const{index:a,isProximityBased:i}=e.detail.indexObj,d=i&&a===e.currentTarget.children.length-1?a+1:a;Se=e.currentTarget,n.splice(d,0,Re),u(e.currentTarget,n,{trigger:g.DRAGGED_ENTERED,id:Oe[r],source:p.POINTER})}function Ye(e){if(!Ie)return;const{items:t,dropFromOthersDisabled:s}=Me.get(e.currentTarget);if(s&&e.currentTarget!==Le)return;const n=Ve(t),o=t.splice(n,1)[0];Se=void 0;const{type:a,theOtherDz:i}=e.detail;if(a===R.OUTSIDE_OF_ANY||a===R.LEFT_FOR_ANOTHER&&i!==Le&&Me.get(i).dropFromOthersDisabled){Fe=!0,Se=Le;const e=Me.get(Le).items;e.splice(be,0,o),u(Le,e,{trigger:g.DRAGGED_LEFT_ALL,id:Oe[r],source:p.POINTER})}u(e.currentTarget,t,{trigger:g.DRAGGED_LEFT,id:Oe[r],source:p.POINTER})}function ze(e){const{items:t,dropFromOthersDisabled:s}=Me.get(e.currentTarget);if(s&&e.currentTarget!==Le)return;Fe=!1;const{index:n}=e.detail.indexObj,o=Ve(t);t.splice(o,1),t.splice(n,0,Re),u(e.currentTarget,t,{trigger:g.DRAGGED_OVER_INDEX,id:Oe[r],source:p.POINTER})}function Xe(e){e.preventDefault();const t=e.touches?e.touches[0]:e;Ae={x:t.clientX,y:t.clientY},$e.style.transform=`translate3d(${Ae.x-Pe.x}px, ${Ae.y-Pe.y}px, 0)`}function He(){Ne=!0,window.removeEventListener("mousemove",Xe),window.removeEventListener("touchmove",Xe),window.removeEventListener("mouseup",He),window.removeEventListener("touchend",He),function(){L();const e=Ce.get(xe);for(const t of e)t.removeEventListener(y,je),t.removeEventListener(T,Ye),t.removeEventListener($,ze);window.removeEventListener(O,He),b()}(),E($e),Se||(Se=Le);let{items:e,type:s}=Me.get(Se);v(Ce.get(s),(e=>Me.get(e).dropTargetStyle),(e=>Me.get(e).dropTargetClasses));let n=Ve(e);-1===n&&(n=be),e=e.map((e=>e[t]?Oe:e)),function(e,t){const r=h(Se.children[e]),s={x:r.left-parseFloat($e.style.left),y:r.top-parseFloat($e.style.top)},{dropAnimationDurationMs:n}=Me.get(Se),o=`transform ${n}ms ease`;$e.style.transition=$e.style.transition?$e.style.transition+","+o:o,$e.style.transform=`translate3d(${s.x}px, ${s.y}px, 0)`,window.setTimeout(t,n)}(n,(function(){_e(),S(Se,e,{trigger:Fe?g.DROPPED_OUTSIDE_OF_ANY:g.DROPPED_INTO_ZONE,id:Oe[r],source:p.POINTER}),Se!==Le&&S(Le,Me.get(Le).items,{trigger:g.DROPPED_INTO_ANOTHER,id:Oe[r],source:p.POINTER}),P(Se.children[n]),$e.remove(),Te.remove(),$e=void 0,Te=void 0,Oe=void 0,xe=void 0,Le=void 0,be=void 0,Re=void 0,Se=void 0,Pe=void 0,Ae=void 0,Ie=!1,Ne=!1,_e=void 0,Fe=!1}))}function qe(e,E){const h={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:ye,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,customStartEvent:""};let L=new Map;function b(){window.removeEventListener("mousemove",S),window.removeEventListener("touchmove",S),window.removeEventListener("mouseup",R),window.removeEventListener("touchend",R)}function R(){b(),Te=void 0,Pe=void 0,Ae=void 0}function S(e){e.preventDefault();const t=e.touches?e.touches[0]:e;Ae={x:t.clientX,y:t.clientY},(Math.abs(Ae.x-Pe.x)>=3||Math.abs(Ae.y-Pe.y)>=3)&&(b(),_())}function P(e){if(e.target!==e.currentTarget&&(void 0!==e.target.value||e.target.isContentEditable))return;if(e.button)return;if(Ie)return;e.stopPropagation();const t=e.touches?e.touches[0]:e;Pe={x:t.clientX,y:t.clientY},Ae={...Pe},Te=e.currentTarget,window.addEventListener("mousemove",S,{passive:!1}),window.addEventListener("touchmove",S,{passive:!1,capture:!1}),window.addEventListener("mouseup",R,{passive:!1}),window.addEventListener("touchend",R,{passive:!1})}function A(e){Te=e.currentTarget,e.detail&&e.detail.startDragPosition&&(Pe=e.detail.startDragPosition,Ae={...Pe},_())}function _(){Ie=!0;const e=L.get(Te);be=e,Le=Te.parentElement;const{items:n,type:o,centreDraggedOnCursor:a}=h;Oe={...n[e]},xe=o,Re={...Oe,[t]:!0};const i={...Re,[r]:s};$e=d(Te,a&&Ae),window.requestAnimationFrame((function e(){$e.parentElement?window.requestAnimationFrame(e):(document.body.appendChild($e),$e.focus(),function(){w();const e=Ce.get(xe);for(const t of e)t.addEventListener(y,je),t.addEventListener(T,Ye),t.addEventListener($,ze);window.addEventListener(O,He);const t=Math.max(100,...Array.from(e.keys()).map((e=>Me.get(e).dropAnimationDurationMs)));x($e,e,1.07*t)}(),D(Te),document.body.appendChild(Te))})),l(Array.from(Ce.get(h.type)).filter((e=>e===Le||!Me.get(e).dropFromOthersDisabled)),(e=>Me.get(e).dropTargetStyle),(e=>Me.get(e).dropTargetClasses)),n.splice(e,1,i),_e=c(Le),u(Le,n,{trigger:g.DRAG_STARTED,id:Oe[r],source:p.POINTER}),window.addEventListener("mousemove",Xe,{passive:!1}),window.addEventListener("touchmove",Xe,{passive:!1,capture:!1}),window.addEventListener("mouseup",He,{passive:!1}),window.addEventListener("touchend",He,{passive:!1})}function I({items:t,flipDurationMs:r=0,type:s="--any--",dragDisabled:d=!1,dropFromOthersDisabled:c=!1,dropTargetStyle:u=ye,dropTargetClasses:g=[],transformDraggedElement:p=(()=>{}),centreDraggedOnCursor:E=!1,customStartEvent:D=""}){var w,y;h.dropAnimationDurationMs=r,h.type&&s!==h.type&&ke(e,h.type),h.type=s,w=e,y=s,Ce.has(y)||Ce.set(y,new Set),Ce.get(y).has(w)||(Ce.get(y).add(w),i()),h.items=[...t],h.dragDisabled=d,h.transformDraggedElement=p,h.centreDraggedOnCursor=E,h.customStartEvent=D,!Ie||Ne||m(u,h.dropTargetStyle)&&f(g,h.dropTargetClasses)||(v([e],(()=>h.dropTargetStyle),(()=>g)),l([e],(()=>u),(()=>g))),h.dropTargetStyle=u,h.dropTargetClasses=[...g],Ie&&h.dropFromOthersDisabled!==c&&(c?v([e],(e=>Me.get(e).dropTargetStyle),(e=>Me.get(e).dropTargetClasses)):l([e],(e=>Me.get(e).dropTargetStyle),(e=>Me.get(e).dropTargetClasses))),h.dropFromOthersDisabled=c,Me.set(e,h);const T=Ve(h.items);for(let t=0;t<e.children.length;t++){const r=e.children[t];n(r,d),t!==T?(h.customStartEvent?r.removeEventListener(h.customStartEvent,Ge.get(r)):(r.removeEventListener("mousedown",Ge.get(r)),r.removeEventListener("touchstart",Ge.get(r))),d||(h.customStartEvent?r.addEventListener(h.customStartEvent,A):(r.addEventListener("mousedown",P),r.addEventListener("touchstart",P)),Ge.set(r,P)),L.set(r,t)):(o($e,r,Ae.x,Ae.y,(()=>h.transformDraggedElement($e,Oe,t))),a(r))}}return I(E),{update:e=>{I(e)},destroy:()=>{ke(e,h.type),Me.delete(e)}}}function Be(e,t){Ue(t);const r=qe(e,t),s=A(e,t);return{update:e=>{Ue(e),r.update(e),s.update(e)},destroy:()=>{r.destroy(),s.destroy()}}}function Ue(e){const{items:t,flipDurationMs:s,type:n,dragDisabled:o,dropFromOthersDisabled:a,dropTargetStyle:i,dropTargetClasses:d,transformDraggedElement:l,autoAriaDisabled:c,centreDraggedOnCursor:u,customStartEvent:g,...p}=e;if(Object.keys(p).length>0&&console.warn("dndzone will ignore unknown options",p),!t)throw new Error("no 'items' key provided to dndzone");const m=t.find((e=>!{}.hasOwnProperty.call(e,r)));if(m)throw new Error(`missing '${r}' property for item ${_(m)}`);if(d&&!Array.isArray(d))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof d}, ${_(d)}`)}function Ze(e){let t,r,s,n,o,a,i,d,l,c,u,g,p=pe(e[3])+"";return{c(){t=C("div"),r=C("div"),s=M(e[1]),n=G(),o=C("div"),a=C("div"),i=M(e[2]),d=G(),l=C("div"),c=M(p),this.h()},l(u){t=k(u,"DIV",{id:!0,class:!0});var g=V(t);r=k(g,"DIV",{class:!0});var m=V(r);s=j(m,e[1]),m.forEach(Y),n=z(g),o=k(g,"DIV",{class:!0});var f=V(o);a=k(f,"DIV",{class:!0});var v=V(a);i=j(v,e[2]),v.forEach(Y),d=z(f),l=k(f,"DIV",{class:!0});var E=V(l);c=j(E,p),E.forEach(Y),f.forEach(Y),g.forEach(Y),this.h()},h(){X(r,"class","text-5xl"),X(a,"class","text-2xl truncate"),X(l,"class","font-mono text-base"),X(o,"class","text-dark flex flex-col overflow-hidden"),X(t,"id",e[0]),X(t,"class","bg-primary border-box flex space-x-2 rounded-3xl bg-primary shadow p-2")},m(p,m){H(p,t,m),q(t,r),q(r,s),q(t,n),q(t,o),q(o,a),q(a,i),q(o,d),q(o,l),q(l,c),u||(g=B(t,"click",e[5]),u=!0)},p:U,i:U,o:U,d(e){e&&Y(t),u=!1,g()}}}function We(e,t,r){let{envelope:s}=t,{_id:n,emoji:o,name:a,value:i}=s;return e.$$set=e=>{"envelope"in e&&r(4,s=e.envelope)},[n,o,a,i,s,function(t){Z(e,t)}]}class Je extends I{constructor(e){super(),N(this,e,We,Ze,F,{envelope:4})}}function Ke(e,t,r){const s=e.slice();return s[8]=t[r],s}function Qe(e){let t,r,s,n,o,a;return s=new we({props:{size:"20"}}),{c(){t=M("LOPY\n    "),r=C("div"),W(s.$$.fragment),this.h()},l(e){t=j(e,"LOPY\n    "),r=k(e,"DIV",{class:!0});var n=V(r);J(s.$$.fragment,n),n.forEach(Y),this.h()},h(){X(r,"class","cursor-pointer")},m(i,d){H(i,t,d),H(i,r,d),K(s,r,null),n=!0,o||(a=B(r,"click",e[3]),o=!0)},p:U,i(e){n||(Q(s.$$.fragment,e),n=!0)},o(e){ee(s.$$.fragment,e),n=!1},d(e){e&&Y(t),e&&Y(r),te(s),o=!1,a()}}}function et(e,t){let r,s,n,o,a,i;return s=new Je({props:{envelope:t[8]}}),s.$on("click",(function(){return t[4](t[8])})),{key:e,first:null,c(){r=C("span"),W(s.$$.fragment),n=G(),this.h()},l(e){r=k(e,"SPAN",{class:!0});var t=V(r);J(s.$$.fragment,t),n=z(t),t.forEach(Y),this.h()},h(){X(r,"class","outline-none cursor-unset"),this.first=r},m(e,t){H(e,r,t),K(s,r,null),q(r,n),o=!0,a||(i=ne(De.call(null,r)),a=!0)},p(e,r){t=e;const n={};1&r&&(n.envelope=t[8]),s.$set(n)},i(e){o||(Q(s.$$.fragment,e),o=!0)},o(e){ee(s.$$.fragment,e),o=!1},d(e){e&&Y(r),te(s),a=!1,i()}}}function tt(e){let t,r,s,n,o,a,i,d=[],l=new Map;t=new fe({props:{$$slots:{default:[Qe]},$$scope:{ctx:e}}});let c=e[0];const u=e=>e[8]._id;for(let t=0;t<c.length;t+=1){let r=Ke(e,c,t),s=u(r);l.set(s,d[t]=et(s,r))}return{c(){W(t.$$.fragment),r=G(),s=C("div");for(let e=0;e<d.length;e+=1)d[e].c();this.h()},l(e){J(t.$$.fragment,e),r=z(e),s=k(e,"DIV",{class:!0});var n=V(s);for(let e=0;e<d.length;e+=1)d[e].l(n);n.forEach(Y),this.h()},h(){X(s,"class","w-full p-4 flex flex-col space-y-3")},m(l,c){K(t,l,c),H(l,r,c),H(l,s,c);for(let e=0;e<d.length;e+=1)d[e].m(s,null);o=!0,a||(i=[ne(n=Be.call(null,s,{items:e[0],flipDurationMs:200,dropTargetStyle:{opacity:"50%"},customStartEvent:"longpress"})),B(s,"start",e[5]),B(s,"consider",e[2]),B(s,"finalize",e[2])],a=!0)},p(e,r){const o={};2048&r&&(o.$$scope={dirty:r,ctx:e}),t.$set(o),3&r&&(c=e[0],oe(),d=ae(d,r,u,1,e,c,l,s,ge,et,null,Ke),ie()),n&&de(n.update)&&1&r&&n.update.call(null,{items:e[0],flipDurationMs:200,dropTargetStyle:{opacity:"50%"},customStartEvent:"longpress"})},i(e){if(!o){Q(t.$$.fragment,e);for(let e=0;e<c.length;e+=1)Q(d[e]);o=!0}},o(e){ee(t.$$.fragment,e);for(let e=0;e<d.length;e+=1)ee(d[e]);o=!1},d(e){te(t,e),e&&Y(r),e&&Y(s);for(let e=0;e<d.length;e+=1)d[e].d();a=!1,le(i)}}}function rt(e){let t,r;return t=new me({props:{$$slots:{default:[tt]},$$scope:{ctx:e}}}),{c(){W(t.$$.fragment)},l(e){J(t.$$.fragment,e)},m(e,s){K(t,e,s),r=!0},p(e,[r]){const s={};2049&r&&(s.$$scope={dirty:r,ctx:e}),t.$set(s)},i(e){r||(Q(t.$$.fragment,e),r=!0)},o(e){ee(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function st(e,t,r){let s,n;re(e,Ee,(e=>r(0,s=e))),re(e,he,(e=>r(7,n=e)));const o=e=>{ce(`${ve.ENVELOPE}/${e._id}`)};let a;se((()=>{a=document.getElementsByTagName("main")[0]}));return[s,o,({detail:e})=>{ue(Ee,s=e.items,s),e.info.trigger===g.DRAG_STARTED&&(a.classList.add("overflow-hidden"),a.classList.remove("overflow-y-scroll")),e.info.trigger.includes("dropped")&&(console.log("stopped"),a.classList.add("overflow-y-scroll"),a.classList.remove("overflow-hidden")),e.info.trigger===g.DROPPED_INTO_ZONE&&n.reorderEnvelopes(e.items)},()=>ce(`${ve.EDIT}/new`),e=>o(e),()=>console.log("starteeed")]}export default class extends I{constructor(e){super(),N(this,e,st,rt,F,{})}}
